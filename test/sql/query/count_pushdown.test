# name: test/sql/query/count_pushdown.test
# description: Verify COUNT(*) is pushed down via MongoDB aggregation pipeline
# group: [query]

require mongo

require-env MONGODB_TEST_DATABASE_AVAILABLE

statement ok
ATTACH 'host=localhost port=27017 dbname=duckdb_mongo_test' AS mongo_test (TYPE MONGO);

# COUNT(*) should be pushed down as an aggregation pipeline ($count) and executed server-side
query II
EXPLAIN SELECT COUNT(*) FROM mongo_test.users WHERE active = true;
----
physical_plan	<REGEX>:.*MONGO_SCAN.*scan_method.*aggregate.*pipeline.*\\$count.*

query I
SELECT COUNT(*) FROM mongo_test.users WHERE active = true;
----
3

statement ok
DETACH mongo_test;

