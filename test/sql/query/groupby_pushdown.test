# name: test/sql/query/groupby_pushdown.test
# description: Verify simple GROUP BY aggregates are pushed down via MongoDB aggregation pipeline
# group: [query]

require mongo

require-env MONGODB_TEST_DATABASE_AVAILABLE

statement ok
ATTACH 'host=localhost port=27017 dbname=duckdb_mongo_test' AS mongo_test (TYPE MONGO);

# GROUP BY should be pushed down as an aggregation pipeline ($group)
query II
EXPLAIN SELECT active, COUNT(*) FROM mongo_test.users GROUP BY active;
----
physical_plan	<REGEX>:[\s\S]*MONGO_SCAN[\s\S]*scan_method[\s\S]*aggregate[\s\S]*pipeline[\s\S]*\$group[\s\S]*

# Correctness check (order enforced in DuckDB, not pushed down)
query II
SELECT active, COUNT(*) FROM mongo_test.users GROUP BY active ORDER BY active;
----
false	1
true	3

statement ok
DETACH mongo_test;

